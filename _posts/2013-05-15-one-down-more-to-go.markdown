---
author: wrfsh
comments: true
date: 2013-05-15 13:52:35+00:00
layout: post
slug: one-down-more-to-go
title: One down, more to go
wordpress_id: 47
tags:
- device state
- preboot
---

Сегодня нам удалось загрузить XP с IDE диска из-под линукса. :)

Что мы узнали по дороге:



	
  1. [8259A](http://en.wikipedia.org/wiki/Intel_8259) PIC нужно не только перемаппировать на rm оффсеты векторов прерываний, но и явно показать кто из них мастер, кто из них слейв, по какой линии они связаны. Дисковые прерывания это IRQ14 и IRQ15 и они должны идти от slave PIC на master PIC и потом уже маппироваться на 0x76 и 0x77 софтверное прерывание соответственно. Без этого доставку прерываний гарантировать нельзя.

	
  2. [Intel 8253](http://en.wikipedia.org/wiki/Intel_8253) / 8254 PIT Программируемый таймер. Ядро использует его в качестве раннего источника тайминга. При этом ядро перепрограммирует его на свой удобный ядру режим. В результате чего (как мы подозреваем) подобие реализации sleep в биосе в реальном режиме никогда не дожидается таймера.

	
  3. Ядру можно запретить перераспределять PCI ресурсы параметром загрузки pci=realloc=off

	
  4. PCI IDE контроллер в итоге не составил никакой проблемы.

	
  5. kexec вообще-то проводит достаточно глубокую деинициализацию платформы.


