---
author: wrfsh
comments: true
date: 2013-05-12 10:24:59+00:00
layout: post
slug: 8259a-interrupt-controller-issues
title: 8259A Interrupt controller issues
wordpress_id: 17
categories:
- BIOS
- device state
---

Другие проблемы, которые точно возникают при возврате из ядра ОС, работающей в защищенном режиме, обратно в реальный это переинициализация [8259A](http://en.wikipedia.org/wiki/Intel_8259) контроллера(ов) прерываний. На типичной PC/AT - совместимой системе таких контроллеров два. Они занимаются тем, что сериализуют прерывания от нескольких устройств и маппируют их на вектора прерываний x86-совместимого процессора. Каждый контроллер предоставляет 8 линий прерываний. Один из контроллеров мастер, а другой слейв.

Для реального режима типичен маппинг 8 линий прерываний первого контроллера на оффсет вектора 0x08, т.е. на вектора 0x08 - 0x0F прерываний процессора. Второй контроллер замаппирован на оффсет 0x70 (0x70 - 0x77). В защищенном режиме Intel резервирует вектора от нуля до 0x1F включительно под аппаратные прерывания, поэтому первый контроллер должен быть перемаплен, но обычно перемаппируют сразу оба контроллера на вектора 0x20 - 0x2F.

В результате по возврату в реальный режим без перемаппирования контроллеров глохнет например клавиатура (IRQ1, real mode INT 09h [08h base + 01h]). К слову сказать это то, что мы видели у McAfee по возврату в реальный режим и то что мы сами тоже уже делаем. А вот что делать с [IO-APIC](http://en.wikipedia.org/wiki/Intel_APIC_Architecture), пока не понятно :)



[http://wiki.osdev.org/PIC#What_does_the_8259_PIC_do.3F](http://wiki.osdev.org/PIC#What_does_the_8259_PIC_do.3F)
